\documentclass{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{cmap}
\usepackage{lmodern}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{marvosym}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{enumitem}

\title{Volcanic Eruption Simulation}

\author{Guillaume Cordonnier, Yannis Kedadry}
\date{}

\begin{document}

\maketitle

\begin{abstract}
When thinking about physical phenomenon, lava flows often come first in mind being both visually impressive and a real natural threat for its surrounding areas. Although being popular, fast and physically accurate eruption simulations can be tricky because of the unusual laws the flow follows and the hard solver needed to resolve them. This paper present a new Lagrangian technique to efficiently simulate lava flows using shallow water equations.
\end{abstract}

\section*{Introduction}

Being able to simulate lava flows in a physically accurate manner can lead to both visually stunning results and a useful prediction tool to prevent causalities of real eruptions. During eruptions, the flow of lava can be seen as a pretty thin layer of fluid; this observation leads us to the idea of using shallow water equations\cite{Solenthaler2011SPHBS} to simulate the flow.

\section*{State of the art}

Simulation of fluids in 3D are well studied in the literature either for Lagrangian solvers or Eulerian methods. Usually these simulations come at high cost, requiring millions of particles to reproduce small scale effects. 
A way to reduce this cost, as used in \textit{insert citation}, is to solve only two components in the 3D space hence reducing the number of operations and the internal size of the simulation. 

- SWE adding horizontal velocity field \cite{Solenthaler2011SPHBS}\\

- SWE for non-uniform terrain \cite{RodrguezPaz2005ACS} (but uniform particles, i.e. same height everywhere)

\section*{Method}

\subsection*{First approach: Shallow-water}

- 2D sph -> sphere over height map\\
- Each particle represents a column of lava of a certain height\\
- Each column same velocity + parallel to the terrain (for now, later add horizontal velocity ?)\\

\begin{align}
    \frac{Dh}{Dt} = -h\nabla.u\\
    u = -\frac{g}{k}\nabla{S} + a_{ext}
\end{align}
$H$: height of the terrain at a given position -> $H(x,y) = z$\\
$h$: height of a particle representing the column of lava, $h$ is calculated using the formula: 
$h \rho_0 = \rho$,\\ 
$\rho_0 = 2500 kg.m^{-3}$ (lava rest density \cite{Griffiths}), $\rho$: the current density of the particle\\
$S$: surface at a given position -> $S_i = H(x_i,y_i) + h_i$\\
$a_{ext}$: contains the viscosity force\\
$g$: the graviational constant\\
$k$: the stiffness coefficient


terrain gradient:\\
- euler method 
\begin{gather*}
    y = H(x,z)\\
    \Delta{x} = \Delta{z} = 1\\
   \frac{\partial H}{\partial x} (x,z) = \frac{H(x+\Delta{x}, z) - H(x,z)}{x+\Delta{x}-x} = H(x+1, z) - y\\
   \frac{\partial H}{\partial z} (x,z) = \frac{H(x, z+\Delta{z}) - H(x,z)}{z+\Delta{z}-z} = H(x, z+1) - y
\end{gather*}

-> simulation explodes without viscosity force so adding them 

\subsubsection*{SPH}

Since we're using 2D SPH, to evaluate a quantity $q$ at an arbitrary position $x$, we interpolate a weighted sum of contribution of the particles $j$ around $x$ within the radius $l$ of a kernel $W$.

\begin{equation}\label{sph}
    q(x) = \sum_j{\frac{m_j}{\rho_j}q_jW(x-x_j, l)}
\end{equation}

Where $x_j$ is the position of the particle $j$, $m_j$ its mass and $\rho_j$ its density.

We discrete the space with particles, so, instead of arbitrary positions, we only consider quantities at each particle position $x_i$

\begin{equation}\label{sph discrete}
    q(x_i) = \sum_j{\frac{m_j}{\rho_j}q_jW(x_i-x_j, l)} = \sum_j{\frac{m_j}{\rho_j}q_jW(r, l)}
\end{equation}

Differential operators act on the kernel only and can be computed using the formulas:

\begin{equation}\label{sph gradient}
    \nabla q(x_i) = \sum_j{\frac{m_j}{\rho_j} q_j \nabla W(r, l)}
\end{equation}

\begin{equation}\label{sph divergence}
    \nabla.q(x_i) = \sum_j{\frac{m_j}{\rho_j} q_j \nabla.W(r, l)}
\end{equation}

\begin{equation}\label{sph laplacien}
    \Delta q(x_i) = \sum_j{\frac{m_j}{\rho_j} q_j \Delta W(r, l)}
\end{equation}

\subsubsection*{Algorithm}

The algorithm for the update loop is the following:

\begin{enumerate}
    \item Compute the neighbours for each particle
    \item Compute the density for each particle using 2D SPH formulas and update the height accordingly
    \item Compute the viscosity
    \item Time integration
    \item Removing particles outside the grid
\end{enumerate}

\begin{flushleft}
To get more into the details of each point:
\end{flushleft}

\begin{enumerate}
    \item Basic grid search using a simple 2D grid (z = 0) (${cell}_{width} = 4*W_{radius}$), get the particles within the cell in which is the current particle and then check if $dist(p_i, p_j) < W_{radius}$ (todo: plot image of the grid)\\

    \item We use a Poly6 Kernel\cite{Solenthaler2011SPHBS} to calculate the density overtime
\begin{equation}\label{kernel poly6}
    W_{poly6} = \frac{4}{\pi l^8}
        \begin{cases} 
            (l^2 - r^2)^3 & 0 \leq r \leq l           
            \\ 0 & \text{otherwise} 
        \end{cases} 
\end{equation}
Once we have the new density for each particle we can find the height of the lava column they represent :
\begin{equation}\label{calcul height}
    h_i = \frac{\rho_i}{\rho_0}
\end{equation}
$\rho_0 = 2500 kg.m^{-3} \text{(lava rest density \cite{Griffiths})}$

    \item The viscosity is very important to stabilize the simulation and since the Laplacien of the poly6 kernel\ref{kernel poly6} can lead to negative values, we used another kernel\cite{Solenthaler2011SPHBS} for the viscosity.
\begin{equation}\label{kernel viscosity}
    W_{viscosity} = \frac{10}{9 \pi l^5}
        \begin{cases} 
            -4r^3 + 9r^2l - 5l^3 + 6l^3(\ln{l} - \ln{r}) & 0 \leq r \leq l           
            \\ 0 & \text{otherwise} 
        \end{cases} 
\end{equation}
\begin{equation}\label{kernel viscosity laplacien}
    \Delta W_{viscosity} = \frac{40}{\pi l^5}(l-r)
\end{equation}

    \item 

\end{enumerate}

\subsection*{Better approach: Stokes problem}

\subsection*{Rendering}

- rendu sur texture \\

\section*{Results}

\section*{Conclusion}

\nocite{*}
\bibliographystyle{unsrt}
\bibliography{files/biblio.bib}

\appendix

%\input{files/blind_deconv}

\end{document}